# ðŸ“˜ DocumentaciÃ³n tÃ©cnica â€” Base de datos `riesgos_data`

## ðŸ”¹ Tabla: `usuarios`

| Columna         | Tipo de dato         | Restricciones / DescripciÃ³n                          |
|-----------------|----------------------|------------------------------------------------------|
| `id`            | integer              | PK, autoincremental                                  |
| `nombre`        | text                 | Obligatorio                                          |
| `email`         | text                 | UNIQUE                                               |
| `clave`         | text                 | Obligatorio                                          |
| `ip_registro`   | text                 | Opcional                                             |
| `ubicacion`     | text                 | Opcional                                             |
| `rol`           | text                 | CHECK: `'admin'`, `'usuario'` â€” Default: `'usuario'` |
| `fecha_registro`| timestamp            | Default: `now()`                                     |

---

## ðŸ”¹ Tabla: `monedas`

| Columna     | Tipo de dato         | Restricciones / DescripciÃ³n                          |
|-------------|----------------------|------------------------------------------------------|
| `id`        | integer              | PK, autoincremental                                  |
| `codigo`    | text                 | UNIQUE                                               |
| `nombre`    | text                 | Obligatorio                                          |
| `tipo`      | text                 | CHECK: `'fiat'`, `'cripto'`                          |
| `pais`      | text                 | Opcional                                             |
| `decimales` | integer              | Default: `2`                                         |
| `activo`    | boolean              | Default: `true`                                      |

---

## ðŸ”¹ Tabla: `fuentes_tasa`

| Columna | Tipo de dato | DescripciÃ³n                  |
|---------|--------------|------------------------------|
| `id`    | integer      | PK, autoincremental          |
| `nombre`| text         | Obligatorio                  |
| `url`   | text         | Opcional                     |

---

## ðŸ”¹ Tabla: `tasas`

| Columna             | Tipo de dato         | DescripciÃ³n                                |
|---------------------|----------------------|--------------------------------------------|
| `id`                | integer              | PK, autoincremental                        |
| `moneda_origen_id`  | integer              | FK â†’ `monedas(id)`                         |
| `moneda_destino_id` | integer              | FK â†’ `monedas(id)`                         |
| `fuente_id`         | integer              | FK â†’ `fuentes_tasa(id)`                    |
| `valor`             | numeric(18,6)        | Obligatorio                                |
| `fecha_hora`        | timestamp            | Default: `now()`                           |

---

## ðŸ”¹ Tabla: `bancos`

| Columna | Tipo de dato | Restricciones / DescripciÃ³n              |
|---------|--------------|------------------------------------------|
| `id`    | integer      | PK, autoincremental                      |
| `nombre`| text         | UNIQUE                                   |
| `tipo`  | text         | CHECK: `'nacional'`, `'internacional'`   |
| `activo`| boolean      | Default: `true`                          |

---

## ðŸ”¹ Tabla: `categorias`

| Columna | Tipo de dato | Restricciones / DescripciÃ³n              |
|---------|--------------|------------------------------------------|
| `id`    | integer      | PK, autoincremental                      |
| `nombre`| text         | UNIQUE                                   |
| `tipo`  | text         | CHECK: `'ingreso'`, `'egreso'`, `'neutral'` |

---

## ðŸ”¹ Tabla: `etiquetas`

| Columna | Tipo de dato | DescripciÃ³n                  |
|---------|--------------|------------------------------|
| `id`    | integer      | PK, autoincremental          |
| `nombre`| text         | UNIQUE                       |

---

## ðŸ”¹ Tabla: `transacciones`

| Columna             | Tipo de dato         | Restricciones / DescripciÃ³n                            |
|---------------------|----------------------|--------------------------------------------------------|
| `id`                | integer              | PK, autoincremental                                    |
| `usuario_id`        | integer              | FK â†’ `usuarios(id)`                                    |
| `moneda_origen_id`  | integer              | FK â†’ `monedas(id)`                                     |
| `moneda_destino_id` | integer              | FK â†’ `monedas(id)`                                     |
| `monto_origen`      | numeric(18,6)        | Obligatorio                                            |
| `monto_convertido`  | numeric(18,6)        | Obligatorio                                            |
| `tasa_aplicada`     | numeric(18,6)        | Obligatorio                                            |
| `fuente_id`         | integer              | FK â†’ `fuentes_tasa(id)`                                |
| `fecha_hora`        | timestamp            | Default: `now()`                                       |
| `banco_id`          | integer              | FK â†’ `bancos(id)`                                      |
| `comision`          | numeric(18,6)        | Default: `0`                                           |
| `tipo_operacion`    | text                 | CHECK: `'compra'`, `'venta'`, `'recepcion'`, `'envio'` |
| `tipo_movimiento`   | text                 | CHECK: `'ingreso'`, `'egreso'`, `'neutral'`            |
| `referencia_externa`| text                 | Opcional                                               |
| `descripcion`       | text                 | Opcional                                               |
| `categoria_id`      | integer              | FK â†’ `categorias(id)`                                  |

---

## ðŸ”¹ Tabla: `transacciones_etiquetas`

| Columna         | Tipo de dato | DescripciÃ³n                        |
|-----------------|--------------|------------------------------------|
| `transaccion_id`| integer      | FK â†’ `transacciones(id)`           |
| `etiqueta_id`   | integer      | FK â†’ `etiquetas(id)`               |

---

## ðŸ”¹ Tabla: `logs`

| Columna     | Tipo de dato | Restricciones / DescripciÃ³n                      |
|-------------|--------------|--------------------------------------------------|
| `id`        | integer      | PK, autoincremental                              |
| `usuario_id`| integer      | FK â†’ `usuarios(id)`                              |
| `tipo`      | text         | CHECK: `'acceso'`, `'error'`, `'api'`, `'conversion'` |
| `mensaje`   | text         | Obligatorio                                      |
| `fecha_hora`| timestamp    | Default: `now()`                                 |

---

## ðŸ”¹ Tabla: `estadisticas`

| Columna           | Tipo de dato | Restricciones / DescripciÃ³n                      |
|-------------------|--------------|--------------------------------------------------|
| `id`              | integer      | PK, autoincremental                              |
| `usuario_id`      | integer      | FK â†’ `usuarios(id)`                              |
| `moneda_id`       | integer      | FK â†’ `monedas(id)`                               |
| `tipo`            | text         | CHECK: `'diaria'`, `'semanal'`, `'mensual'`      |
| `porcentaje_cambio`| numeric(6,2)| Obligatorio                                      |
| `fecha`           | timestamp    | Obligatorio                                      |

---

## ðŸ”¹ Vistas

- `balance_por_moneda`: muestra ingresos, egresos, balance neto y equivalente en Bs por usuario y moneda
- `transacciones_resumen`: resumen completo de cada transacciÃ³n con joins a todas las entidades
- `transacciones_eficiencia`: calcula variaciÃ³n y resultado entre USD â†” USDT

---

## ðŸ”¹ FunciÃ³n

```sql
convertir_monto(origen text, destino text, monto numeric)
